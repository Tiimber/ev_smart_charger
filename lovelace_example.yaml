type: vertical-stack
cards:
  - type: custom:apexcharts-card
    experimental:
      color_threshold: true
    apex_config:
      chart:
        height: 350px
    header:
      show: true
      title: Smart Charging Plan
      show_states: false
    span:
      start: minute
    series:
      - entity: sensor.charging_schedule
        name: Price
        type: line
        yaxis_id: price
        color: "#a42"
        opacity: 0.6
        show:
          legend_value: false
        data_generator: |
          return entity.attributes.schedule.map((entry) => {
            return [new Date(entry.start).getTime(), entry.price];
          });
        color_threshold:
          - value: -1
            color: green
          - value: 0.5
            color: yellow
          - value: 1.5
            color: orange
          - value: 4
            color: red
      - entity: sensor.charging_schedule
        name: Charging
        type: area
        curve: stepline
        color: darkgreen
        yaxis_id: charging
        show:
          legend_value: false
        data_generator: |
          return entity.attributes.schedule.map((entry) => {
            return [new Date(entry.start).getTime(), entry.active ? 1 : 0];
          });
    yaxis:
      - id: price
        decimals: 2
        min: 0
      - id: charging
        opposite: true
        min: 0
        max: 1
        apex_config:
          tickAmount: 1
          labels:
            formatter: |
              EVAL:function(value) {
                return value === 1 ? 'On' : 'Off';
              }
  - type: markdown
    content: "{{ state_attr('sensor.charging_schedule', 'charging_summary') }}"
  - type: entities
    title: Settings
    entities:
      - entity: time.ev_optimizer_standard_departure_time
      - entity: number.standard_target_soc
      - type: divider
      - entity: number.price_limit_low_cheap
      - entity: number.target_soc_at_low_price
        name: Low Price Target SoC
      - entity: number.price_limit_high_acceptable
      - entity: number.target_soc_at_high_price
        name: High Price Target SoC
  - type: entities
    title: Overrides
    entities:
      - entity: time.ev_optimizer_next_session_departure
      - entity: number.next_session_target_soc
      - entity: button.clear_manual_override
